#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <ctype.h>
#define MAX_TEXT 1000
#define MAX_RESULTS 10
#define ALPHABET_SIZE 26
const char *english_order = "ETAOINSHRDLCUMWFGYPBVKJXQZ";
typedef struct {
    char letter;
    int count;
} Frequency;
int compareFreq(const void *a, const void *b) {
    return ((Frequency *)b)->count - ((Frequency *)a)->count;
}
void countFrequencies(char *text, Frequency freq[]) {
    for (int i = 0; i < ALPHABET_SIZE; i++) {
        freq[i].letter = 'A' + i;
        freq[i].count = 0;
    }
    for (int i = 0; text[i]; i++) {
        if (isalpha(text[i])) {
            char ch = toupper(text[i]);
            freq[ch - 'A'].count++;
        }
    }
    qsort(freq, ALPHABET_SIZE, sizeof(Frequency), compareFreq);
}
void buildMapping(Frequency freq[], char map[26], int shift) {
    for (int i = 0; i < ALPHABET_SIZE; i++) {
        if (i + shift < ALPHABET_SIZE) {
            map[freq[i].letter - 'A'] = english_order[i + shift];
        } else {
            map[freq[i].letter - 'A'] = freq[i].letter; 
        }
    }
}
void applyMapping(char *ciphertext, char *plaintext, char map[26]) {
    for (int i = 0; ciphertext[i]; i++) {
        if (isalpha(ciphertext[i])) {
            char ch = toupper(ciphertext[i]);
            char mapped = map[ch - 'A'];
            plaintext[i] = islower(ciphertext[i]) ? tolower(mapped) : mapped;
        } else {
            plaintext[i] = ciphertext[i];  
        }
    }
    plaintext[strlen(ciphertext)] = '\0';
}
int main() {
    char ciphertext[MAX_TEXT];
    int topN;
    printf("Enter the ciphertext (monoalphabetic cipher):\n");
    scanf(" %[^\n]", ciphertext);
    printf("Enter the number of top guesses to show (max 10): ");
    scanf("%d", &topN);
    if (topN > MAX_RESULTS) topN = MAX_RESULTS;
    Frequency freq[ALPHABET_SIZE];
    char plaintext[MAX_TEXT];
    char map[26];
    countFrequencies(ciphertext, freq);
    printf("\nTop %d possible plaintexts (based on frequency analysis):\n", topN);
    for (int i = 0; i < topN; i++) {
        buildMapping(freq, map, i);
        applyMapping(ciphertext, plaintext, map);
        printf("\nOption %d:\n%s\n", i + 1, plaintext);
    }
    return 0;
}
